#oracle note
3. Software installation (DONE)

4. Pre-upgrade Tasks:
4.1 Copy spfile and password file from 12c to 19c home:
SQL> show parameter spfile
    /oracle12c/OraHome1/dbs/spfileORCL.ora

$ cp /oracle12c/OraHome1/dbs/spfileORCL.ora /oracle12c/OraHome19c/dbs/
$ cp /oracle12c/OraHome1/dbs/orapwORCL /oracle12c/OraHome19c/dbs/

4.2 List of Invalid Objects:
SQL> select count(*) from dba_objects where status='INVALID';

  COUNT(*)
----------
         1

#SQL> select object_type, object_name, status from dba_objects where status = 'INVALID';

#SQL> select * from dba_errors where name='CONV_DATA';

4.3 Database Full Backup:
SQL> CREATE DIRECTORY GVPP_DATA_PUMP_DIR AS '/oracle12c/dbpatch/backup/dmp';

expdp system/strata@orcl FULL=y include=SCHEMA:\"IN \(\'GVPP_O\',\'GVPP\'\)\",ROLE,USER,SYSTEM_GRANT,ROLE_GRANT,DEFAULT_ROLE,TABLESPACE_QUOTA,TABLESPACE,DIRECTORY directory=GVPP_DATA_PUMP_DIR dumpfile=ginodb1_backup_12c.dmp logfile=ginodb1_backup_12c.log

4.4. Run preupgrade.jar tools:
/oracle12c/OraHome19c/jdk/bin/java -jar /oracle12c/OraHome19c/rdbms/admin/preupgrade.jar TERMINAL TEXT
.....

4.5. Perform all recommendation (for before upgrade) done by preupgrade.jar by above command:
4.5.1. Recompile Invalid Objects:
sqlplus / as sysdba <<EOF 
@\$ORACLE_HOME/rdbms/admin/utlrp.sql
set linesize 1000;
SET SERVEROUTPUT ON;
EXECUTE DBMS_PREUP.INVALID_OBJECTS;
exit; 
EOF

4.6. Execute Pre-upgrade Fixing script generated by preupgrade.jar tools:
sqlplus / as sysdba <<EOF 
@\$ORACLE_HOME/cfgtoollogs/ORCL/preupgrade/preupgrade_fixups.sql
exit; 
EOF

#4.7. Create a Flashback Guaranteed Restore Point:
/oracle12c/OraHome1/bin/sqlplus / as sysdba
SQL> shutdown immediate
SQL> startup mount
SQL> select flashback_on from v$database;
SQL> show parameter compatible
SQL> select * from V$restore_point;

SQL> alter database archivelog;
SQL> show parameter db_recovery_file;
SQL> alter system set db_recovery_file_dest_size=20G scope=both;
SQL> alter system set db_recovery_file_dest='/oracle12c/oradata/FRA' scope=both;
SQL> show parameter db_recovery_file;
SQL> create restore point pre_upgrade guarantee flashback database;


SQL>
col name for a20
col GUARANTEE_FLASHBACK_DATABASE for a10
col TIME for a60
set lines 190
SQL> select NAME,GUARANTEE_FLASHBACK_DATABASE,TIME from V$restore_point;
NAME                 GUARANTEE_ TIME
-------------------- ---------- ------------------------------------------------------------
PRE_UPGRADE          YES        19-OCT-21 02.45.16.000000000 PM
SQL> alter database flashback off;

4.8 Shutdown the listener and database 12c 

4.9. Change .profile of 12c to 19c 
envPrep function

5. Upgrade Tasks:
5.1 Startup listener 19c.
lsnrctl start

5.2 Startup 12c database in upgrade mode from oracle 19c home:
sqlplus / as sysdba
SQL> startup upgrade
SQL> select name,open_mode,cdb,version,status from v$database,v$instance;

5.3 Run Database Upgrade Command:




